<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Dev Diaries - PCAPAnalyzer II: uncharted territory! | Devlogs from a non-developer</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Dev Diaries - PCAPAnalyzer II: uncharted territory!" />
<meta name="author" content="Ivan Mendez" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve never really built a backend before" />
<meta property="og:description" content="I’ve never really built a backend before" />
<link rel="canonical" href="http://localhost:4000/blog/dev%20diaries/dev-diaries-pcapanalyzer-II/" />
<meta property="og:url" content="http://localhost:4000/blog/dev%20diaries/dev-diaries-pcapanalyzer-II/" />
<meta property="og:site_name" content="Devlogs from a non-developer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-11T10:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Dev Diaries - PCAPAnalyzer II: uncharted territory!" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/blog/dev%20diaries/dev-diaries-pcapanalyzer-II/","headline":"Dev Diaries - PCAPAnalyzer II: uncharted territory!","dateModified":"2021-03-11T10:00:00+01:00","datePublished":"2021-03-11T10:00:00+01:00","description":"I’ve never really built a backend before","author":{"@type":"Person","name":"Ivan Mendez"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/dev%20diaries/dev-diaries-pcapanalyzer-II/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Devlogs from a non-developer" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Devlogs from a non-developer</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/posts/">Archive</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Dev Diaries - PCAPAnalyzer II: uncharted territory!</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-03-11T10:00:00+01:00" itemprop="datePublished">Mar 11, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The whole concept of asynchronous programming or service development is something I never got to learn on my classes. I did try self-learning, but this really felt like I’d need a tutor. To my surprise, this backend thing ended up working out!</p>

<p>The word “backend” to me speaks like I am out here building an actual tool. One of those concepts you hear in actual open source projects that we all use literally every day. “frontend”, “backend”, “stack”… stuff apparently you should have for “scalability” or something. And thanks to this project, I got to learn how important, and how complicated, a good backend architecture is about. If you build it <em>well</em>, but you build it <em>once</em>.</p>

<p>My happy self, Unbenownkst of the actual difficulty of these tasks, did not follow neither of those words while wholeheartedly believing I was building good architecture. But I would find out about this much, much later, so we’ll address that in a future post detailing just how much I learnt while rewriting my own bad code.</p>

<p>So, let’s remember what we dedided we needed for this application backend.</p>

<p>We wanted to capture interface communication data on a machine with industry standard tooling. This task was accomplished with <code class="highlighter-rouge">tshark</code>, the incredibly versatile command line interface for <code class="highlighter-rouge">wireshark</code>, the absolute standard for network data analysis. There were other considerations, like <code class="highlighter-rouge">tcpdump</code>, but I’ve always seen that one as a “quick and dirty” tool for a basic live monitoring job, no analysis. Both of them use the <code class="highlighter-rouge">libpcap</code> standard library under the hood anyways, so it’s up to interface usage.</p>

<p>Next, we need to store that big amount of data in one single place, and we need to retrieve it fast. Here enters <code class="highlighter-rouge">mysql</code>, the biggest relational database management system out there by far. Or, at least, its open source counterpart <code class="highlighter-rouge">mariadb</code> because there will be no Oracle licensing in this house. Not on my watch, at the very least. Well, I do use VirtualBox, but that kinda doesn’t count, because that’s not production-designed software. I mean, it’s <em>VirtualBox</em>. It’s the toy equivalent of virtualization software. But, I’m losing track, moving on.</p>

<p>Unfortunately, both of these use their own binary file writing standards, incompatible with each other, because sometimes you decide to prioritize internal reading optimization at the cost of application interoperability, but this is not for us. So, we need <code class="highlighter-rouge">csv</code>’s. We generate these <code class="highlighter-rouge">csv</code>’s with the programming language I am the most comfortable with using thanks to my classes, <code class="highlighter-rouge">python3</code>. Human-readable, me-writable!</p>

<p>Okay, so, tools chosen, next it’s infrastructure time. First, the easy part: copying (and slightly modifying) a <code class="highlighter-rouge">tcpdump</code> command for continuous <code class="highlighter-rouge">.pcap</code> generation on a folder. That one was easy. Then, move the completed ones to a new directory with some <code class="highlighter-rouge">bash script</code> dark magic. Slightly less easy, but <code class="highlighter-rouge">man</code> and StackOveflow were the usual lifesavers, so it got to a working state soon enough. script it in python with some help of importing the <code class="highlighter-rouge">os</code> library for command execution and filesystem management, and the first part was set!</p>

<p>Second step: convert these <code class="highlighter-rouge">.pcap</code> files into a universally readable <code class="highlighter-rouge">csv</code> file. After some DuckDuckGo-ing I got <code class="highlighter-rouge">tshark</code> to read these files into rows of text separated by commas, each one being one packet from the system. Then I noticed that this was gonna be a bit harder, because this wasn’t enough of a challenge and it was getting boring, right? Well, apparently, someone over at the god forsaken lands of Wireshark development space decided that who needs ISO compliant date formats? What for? not like interoperability is important, right? especially who would need well formatted <em>dates</em>, eh?</p>

<p>Well, thankfully, someone on that team has earned their angel wings by force of feature implementation with something called <code class="highlighter-rouge">epoch time</code>, a format that counts the seconds that have passed since January 1st, 1970 (does this date ring a bell? I’m sure you’ve seen it when some time error happens), universally used as standard time on UTC, so we’ll use that and be off the races. One epoch to datetime conversion and some string joining on the script, and we write it off to our next step!</p>

<p>Step three was kind of weird. See, <code class="highlighter-rouge">mysql</code> is an Oracle product. So the one to one compatibility needs are transported to <code class="highlighter-rouge">mariadb</code>. This means we have a really good database connection driver written for <em>java</em>. I am not using java. After some investigation I quickly found out that on our case, library choice is a bit more of a mess. There’s <code class="highlighter-rouge">mysql.connector</code>, <code class="highlighter-rouge">MySQLdb</code>… everyone claims to be the standard and better than everyone else. <a href="https://xkcd.com/927/">Relevant xkcd</a>. But anyways, I ended up with <code class="highlighter-rouge">MySQLdb</code> just to choose one of the competent ones, and get doing. It was simple enough to read a file for lines, and run an <code class="highlighter-rouge">INSERT</code> query for every entry into the database.</p>

<p>Yes, I know. We’ll talk about that on the mistakes post. Good thing I had a database class teacher near me!</p>

<p>now, at this point, I could run through the entire process to make it work, fixing rough edges here ad there. But it was <em>me</em> running the scripts on the system. That doesn’t sound very backend service-y, does it? So, it was time for the newest kid in my town: process management. This is something that, to me, as a last year vocational studies systems administration student, sounded <em>spooky</em>. Fortunatrly, it ended up being way easier than I expected it to be! I just imported the <code class="highlighter-rouge">os</code> library, tried simply running the scripts as subprocesses of this <code class="highlighter-rouge">start.py</code> script, and after some playing around with relative paths (the <code class="highlighter-rouge">os</code> library does some weird things to relative paths depending on where you run it) and it was working!</p>

<p>Next was to control it from the system, because I can’t go around putting “just kill <code class="highlighter-rouge">start.py</code>” on the documentation. I had never written a custom service file. Hell, I had to google where they were stored! but again, GNU/Linux is amazing like that, so with some documentation and some observing the already made <code class="highlighter-rouge">.service</code> files, the thing was just working. Intuitive and human-readable as anything I’ve ever used. As much fun as I like to poke at <code class="highlighter-rouge">systemd</code>, I don’t think I can use anything but service files anymore.</p>

<p>So, apparently, this was done! a bit more tweaking in script sleeping times on the main script launcher, and a lot more tweaking to maken actually valid <code class="highlighter-rouge">csv</code> for edge cases that creeped up on me, and the backend was fully operative and chugging along! Job well done! (writer’s note: I did not know about the fact that I had enough material for a mistakes blogpost back at that time. I was young, happy and naïve.)</p>

<p>So I had a backend! it fully worked, and I could <code class="highlighter-rouge">SELECT</code> away all my network packets away however big the thing was, filer with anything I wanted… Wireshark (mostly) meets SQL!</p>

<p>As a usual habit, let’s list what we ended up with in a bullet point list for summarizing my text blocks</p>

<ul>
  <li>We start capturing data with an unending <code class="highlighter-rouge">tshark</code> task, from a <code class="highlighter-rouge">python</code> script with the <code class="highlighter-rouge">os</code> library</li>
  <li>When the files are done being written to, we move them with a bash incantation I cannot fully decipher</li>
  <li>When files are moved to the new location, we run them through a python script that
    <ol>
      <li>Reads the <code class="highlighter-rouge">.pcap</code> file into standard input</li>
      <li>we modify the <code class="highlighter-rouge">epoch time</code> entries into UTC time</li>
      <li>we join empty fields into consistent entries that <code class="highlighter-rouge">tshark</code> separates by default</li>
      <li>We write it all into a new processed <code class="highlighter-rouge">csv</code> in a standard usable format for our database scheme</li>
    </ol>
  </li>
  <li>The new CSV is fed into the <code class="highlighter-rouge">python</code> library called <code class="highlighter-rouge">MySQLdb</code> that connects to our <code class="highlighter-rouge">mysql</code> instance and runs an <code class="highlighter-rouge">INSERT</code> query for each row on the file</li>
</ul>

<p>Working infrastructure!</p>

<p>But a backend is that. <em>back</em>. Like the back of a refrigerator, it’s pretty damn ugly to look at if you don’t know what you’re working on. So, on the next blogpost: frontend! we get to see why I am even less of a designer than I am a developer! responsive can’t be that hard of a task, can it?</p>

<p>We’ll see how that train of thought ended as the inevitable full scale railway accident it was meant to be since the moment I said “responsive design”.</p>

  </div><a class="u-url" href="/blog/dev%20diaries/dev-diaries-pcapanalyzer-II/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Devlogs from a non-developer</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ivan Mendez</li><li><a class="u-email" href="mailto:ivanm106@gmail.com">ivanm106@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ivanol55"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ivanol55</span></a></li><li><a href="https://www.linkedin.com/in/ivanmendezrodriguez"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">ivanmendezrodriguez</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ivanol55&#39;s technical writeup blog, where a non-developer will ramble about how they fight with self-learning something outside of their professional scope and will take you along for the ride!</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
